<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Writing your own functions</title>
    <meta charset="utf-8" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link rel="stylesheet" href="xaringan-themer.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

# Writing your own functions
### 

---








# Why write functions

* Functions allow you to automate common tasks

--

* We've been using functions since Day 1
  
* Did you ever find yourself copy-pasting an analysis and changing small parts?
  
--

* Writing your OWN functions has 3 big advantages over copy-and-paste:

1. Your code is easier to read (give a function an informative name!) 

2. To change your analysis, simply change the function

3. No more mistakes from copy-paste

---

# A simple function


```r
add_two &lt;- function(x) {
  
  x + 2
  
}

add_two(5)
```

```
## [1] 7
```

--

`x` is a placeholder!

Whatever is entered in the function is passed along under the name "x".
---

# A simple function

The **name** of the function is chosen by the author.


&lt;code class ='r hljs remark-code'&gt;&lt;span style="background-color:#ffff7f"&gt;add_two&lt;/span&gt; &lt;- function(x) {&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;x + 2&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;}&lt;br&gt;&lt;br&gt;&lt;span style="background-color:#ffff7f"&gt;add_two&lt;/span&gt;(5)&lt;/code&gt;

```

## [1] 7

```

---
# Word of Caution 1

Function names have no inherent meaning.


```r
add_three &lt;- function(x) {
  
  x + 7
  
}

add_three(5)
```

What will this give us?

---
# A simple function

The **argument(s)** of the function are chosen by the author.


&lt;code class ='r hljs remark-code'&gt;add_two &lt;- function(&lt;span style="background-color:#ffff7f"&gt;x&lt;/span&gt;) {&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;span style="background-color:#ffff7f"&gt;x&lt;/span&gt; + 2&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;}&lt;br&gt;&lt;br&gt;add_two(5)&lt;/code&gt;

```

## [1] 7

```

---
# A simple function

The **body** of the function is where the action happens.


&lt;code class ='r hljs remark-code'&gt;add_two &lt;- function(x) {&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;span style="background-color:#ffff7f"&gt;x + 2&lt;/span&gt;&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;}&lt;br&gt;&lt;br&gt;add_two(5)&lt;/code&gt;

```

## [1] 7

```

---
class: center, middle, inverse

# Arguments

---
# Word of Caution 2

Unless you are very very experienced, do **not** reference outside objects!


```r
add_two &lt;- function() {
  
  x + 2
  
}

add_two()
```

```
## Error in add_two(): object 'x' not found
```

```r
x &lt;- 10

add_two()
```

```
## [1] 12
```

---
# Optional arguments

If you supply a default value, the argument is optional:




&lt;code class ='r hljs remark-code'&gt;add_something &lt;- function(x, &lt;span style="background-color:#ffff7f"&gt;something = 2&lt;/span&gt;) {&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;x + something&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;}&lt;br&gt;&lt;br&gt;add_something(5)&lt;/code&gt;

```

## [1] 7

```



&lt;code class ='r hljs remark-code'&gt;add_something(5, &lt;span style="background-color:#ffff7f"&gt;something = 6&lt;/span&gt;)&lt;/code&gt;

```

## [1] 11

```

---
# Required arguments

If you **do not** supply a default value, the argument is **required**:


```r
add_something &lt;- function(x, something = 2) {
  
  x + something
  
}

add_something()
```

```
## Error in add_something(): argument "x" is missing, with no default
```


---
class: center, middle, inverse

# What gets returned

---
# Returns

Your function will "give back" whatever would normally "print out".


```r
add_two &lt;- function(x) {
  
  x + 2
  
}

7 + 2
```

```
## [1] 9
```

```r
add_two(7)
```

```
## [1] 9
```
---
# Returns

You can be explict (and clearer) by using `return()`


```r
add_two &lt;- function(x) {
  
  return(x + 2)
  
}
```

---
# Returns

Objects you make in the function don't affect "real life".


```r
add_two &lt;- function(x) {
  
  my_result &lt;- x + 2
  
  return(my_result)
  
}

my_result &lt;- 2000

add_something(5)
```

```
## [1] 7
```

```r
my_result
```

```
## [1] 2000
```

---
# Environments

* The top right pane of your RStudio shows you **environment**.

* This is the "current state" of the objects you've created.

--

* The code inside the function executes in the **function environment**.

* It does not change your **global environment**.

--

* (When you knit a `.Rmd` file, it runs the code in another separate environment!)

---
# Conditional returns

Maybe you want to return different results in different situations




&lt;code class ='r hljs remark-code'&gt;even_or_odd &lt;- function(x) {&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;if (&lt;span style="background-color:#ffff7f"&gt;x %% 2 == 0&lt;/span&gt;) {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return("&lt;span style="background-color:green"&gt;It's even!&lt;/span&gt;")&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;} else {&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;return("&lt;span style="background-color:pink"&gt;It's odd.&lt;/span&gt;")&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;}&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;&amp;nbsp;&amp;nbsp;&lt;br&gt;}&lt;/code&gt;
---
# Print versus return



```r
even_or_odd &lt;- function(x) {
  
  if (x %% 2 == 0) {
    
    return("It's even!")
    
  } else {
    
    return("It's odd.")
    
  }
  
  
}

bob &lt;- even_or_odd(7)

bob
```

```
## [1] "It's odd."
```

---
# Print versus return



```r
even_or_odd &lt;- function(x) {
  
  if (x %% 2 == 0) {
    
    cat("It's even!")
    
  } else {
    
    cat("It's odd.")
    
  }
  
  return(x)
  
  
}

bob &lt;- even_or_odd(7)
```

```
## It's odd.
```

```r
bob
```

```
## [1] 7
```

---

# Your turn

Write a function called `times_seven()` which takes a single argument and multiplies by 7. 

--
*Sneak Preview* What happens when you run this?


```r
my_vec &lt;- c(7, 8, 9)

times_seven(my_vec)
```


What about this?


```r
times_seven(mtcars)
```

---
class: center, middle, inverse

# Errors

---
# Errors


```r
add_something &lt;- function(x, something = 2) {
  
  if (!is.numeric(something)) {
    
    stop("Please enter a number!")
    
  }
  
  x + something
  
}
```

---
# Errors

```r
add_something(5, something = "bob")
```

```
## Error in add_something(5, something = "bob"): Please enter a number!
```


---

# Your turn

Write a function called `times_seven()` which takes a single argument and multiplies by 7. 

This function should check that the argument is numeric.

This function should also excitedly announce (print) "I love sevens!" if the argument to the function is a 7.

--
*Sneak Preview:* What happens when you run this?


```r
my_vec &lt;- c(7, 8, 9)

times_seven(my_vec)
```

---

# When should you write a function?

* Consider writing a function whenever you've copied and pasted a block of code more than twice

--

* Consider the following bit of code. What does it do?


```r
myiris &lt;- iris

myiris$Sepal.Length &lt;- (myiris$Sepal.Length - mean(myiris$Sepal.Length)) / sd(myiris$Sepal.Length)
myiris$Sepal.Width &lt;- (myiris$Sepal.Width - mean(myiris$Sepal.Length)) / sd(myiris$Sepal.Width)
myiris$Petal.Length &lt;- (myiris$Petal.Length - mean(myiris$Petal.Length)) / sd(myiris$Petal.Length)
myiris$Petal.Width &lt;- (myiris$Petal.Width - mean(myiris$Petal.Width)) / sd(myiris$Petal.Width)
```

--

* That's right, this code standardizes each of the variables in `myiris` to have mean 0 and standard deviation 1

--

* ...or does it?

---
# Dangers of copy-paste


&lt;code class ='r hljs remark-code'&gt;myiris &lt;- iris&lt;br&gt;&lt;br&gt;myiris$&lt;span style="background-color:pink"&gt;Sepal.Length&lt;/span&gt; &lt;- (myiris$&lt;span style="background-color:pink"&gt;Sepal.Length&lt;/span&gt; - mean(myiris$&lt;span style="background-color:pink"&gt;Sepal.Length&lt;/span&gt;)) / sd(myiris$&lt;span style="background-color:pink"&gt;Sepal.Length&lt;/span&gt;)&lt;br&gt;myiris$&lt;span style="background-color:#ffff7f"&gt;Sepal.Width&lt;/span&gt; &lt;- (myiris$&lt;span style="background-color:#ffff7f"&gt;Sepal.Width&lt;/span&gt; - mean(myiris$&lt;span style="background-color:pink"&gt;Sepal.Length&lt;/span&gt;)) / sd(myiris$&lt;span style="background-color:#ffff7f"&gt;Sepal.Width&lt;/span&gt;)&lt;br&gt;myiris$Petal.Length &lt;- (myiris$Petal.Length - mean(myiris$Petal.Length)) / sd(myiris$Petal.Length)&lt;br&gt;myiris$Petal.Width &lt;- (myiris$Petal.Width - mean(myiris$Petal.Width)) / sd(myiris$Petal.Width)&lt;/code&gt;


---

# Let's Make This a Function

* Three key steps to creating a function:

1. Pick a **name** for the function: informative and usually a **verb**

2. List the inputs, or **arguments**, of the function inside `function()`

3. Place the code we've developed in the **body** of the function, a `{` block following `function()`

--


```r
standardize &lt;- function(data) {
  (data - mean(data)) / sd(data)
}

# OR

standardize &lt;- function(data) {
  newdata &lt;- (data - mean(data)) / sd(data)
  return(newdata)
}
```

What object structure/type does this function **expect**?
What does it **return**?

--
```
standardize(myiris$Sepal.Length)
```

---

# Intermediate Steps - Function Building Blocks


* Functions can get complex quickly

* It's often a good idea to pull out intermediate calculations into named variables to increase clarity


```r
standardize &lt;- function(data) {
  deviations &lt;- data - mean(data)
  newdata &lt;- deviations / sd(data)
  return(newdata)
}
```

---

# Pump The Breaks a Bit

* As exciting as working in R and writing functions can be, testing is **important**

--

* What if our dataset isn't as clean as `iris`?

--


```r
testdata &lt;- c(2, 4, 3, 9, NA, 4, 6)
standardize(testdata)
```

```
## [1] NA NA NA NA NA NA NA
```


---

# Testing

We Only Need to Change the Code in One Place: `standardize()`




&lt;code class ='r hljs remark-code'&gt;standardize &lt;- function(data) {&lt;br&gt;&amp;nbsp;&amp;nbsp;deviations &lt;- data - mean(data, &lt;span style="background-color:#ffff7f"&gt;na.rm = TRUE&lt;/span&gt;)&lt;br&gt;&amp;nbsp;&amp;nbsp;newdata &lt;- deviations / sd(data, &lt;span style="background-color:#ffff7f"&gt;na.rm = TRUE&lt;/span&gt;)&lt;br&gt;&amp;nbsp;&amp;nbsp;return(newdata)&lt;br&gt;}&lt;br&gt;&lt;br&gt;testdata &lt;- c(2, 4, 3, 9, NA, 4, 6)&lt;br&gt;standardize(testdata)&lt;/code&gt;

```

## [1] -1.0652473 -0.2663118 -0.6657796  1.7310268         NA -0.2663118  0.5326236

```

---



&lt;code class ='r hljs remark-code'&gt;myiris &lt;- iris&lt;br&gt;&lt;br&gt;myiris$Sepal.Length &lt;- (myiris$Sepal.Length - mean(myiris$Sepal.Length, &lt;span style="background-color:#ffff7f"&gt;na.rm = TRUE&lt;/span&gt;)) / sd(myiris$Sepal.Length, &lt;span style="background-color:#ffff7f"&gt;na.rm = TRUE&lt;/span&gt;)&lt;br&gt;myiris$Sepal.Width &lt;- (myiris$Sepal.Width - mean(myiris$Sepal.Length, &lt;span style="background-color:#ffff7f"&gt;na.rm = TRUE&lt;/span&gt;)) / sd(myiris$Sepal.Width, &lt;span style="background-color:#ffff7f"&gt;na.rm = TRUE&lt;/span&gt;)&lt;br&gt;myiris$Petal.Length &lt;- (myiris$Petal.Length - mean(myiris$Petal.Length, &lt;span style="background-color:#ffff7f"&gt;na.rm = TRUE&lt;/span&gt;)) / sd(myiris$Petal.Length, &lt;span style="background-color:#ffff7f"&gt;na.rm = TRUE&lt;/span&gt;)&lt;br&gt;myiris$Petal.Width &lt;- (myiris$Petal.Width - mean(myiris$Petal.Width, &lt;span style="background-color:#ffff7f"&gt;na.rm = TRUE&lt;/span&gt;)) / sd(myiris$Petal.Width, &lt;span style="background-color:#ffff7f"&gt;na.rm = TRUE&lt;/span&gt;)&lt;/code&gt;

---

# Variables as arguments

We haven't eliminated copy-and-pasting from our `iris` example, right?


```r
myiris$Sepal.Length &lt;- standardize(myiris$Sepal.Length)
myiris$Sepal.Width &lt;- standardize(myiris$Sepal.Width)
myiris$Petal.Length &lt;- standardize(myiris$Petal.Length)
myiris$Petal.Width &lt;- standardize(myiris$Petal.Width)
```

---
# Variables as arguments

You probably would like to do this...


```r
stdize_column &lt;- function(dat, variable) {
  dat &lt;- dat %&gt;%
    mutate(
      variable = standardize(variable)
    )
  return(dat)
}
```

*(Notice how we relied on the existing function `stdize()` inside the new function, for clarity!)*

---
# Variables as arguments

Alas...


```r
stdize_column(iris, Petal.Length)
```

```
## Error: Problem with `mutate()` input `variable`.
## x object 'Petal.Length' not found
## i Input `variable` is `standardize(variable)`.
```

What happened?

---
# Tidy evaluation


&lt;code class ='r hljs remark-code'&gt;stdize_column &lt;- function(dat, variable) {&lt;br&gt;&amp;nbsp;&amp;nbsp;dat &lt;- dat %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;mutate(&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;variable = standardize(variable)&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;)&lt;br&gt;&amp;nbsp;&amp;nbsp;return(dat)&lt;br&gt;}&lt;/code&gt;


---
# Tidy evaluation

Functions that use **unquoted** variable names as arguments are called **nonstandard evaluation** or **tidy evaluation**.

--

They make life easier for users:


```r
iris %&gt;% pull(Petal.Length)
# or
iris$Petal.Length
# instead of
iris[, "Petal.Length"]
# or
iris[["Petal.Length"]]
```

but they are complicated to write!

---
# Solutions

1. Just don't use it in your functions.  Harder to read/use, but safe.


```r
stdize_column &lt;- function(dat, variable) {
  dat[[variable]] &lt;- standardize(dat[[variable]])
  return(dat)
}

stdize_column(iris, "Petal.Length")
```

```
##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
## 1            5.1         3.5  -1.33575163         0.2     setosa
## 2            4.9         3.0  -1.33575163         0.2     setosa
## 3            4.7         3.2  -1.39239929         0.2     setosa
## 4            4.6         3.1  -1.27910398         0.2     setosa
## 5            5.0         3.6  -1.33575163         0.2     setosa
## 6            5.4         3.9  -1.16580868         0.4     setosa
## 7            4.6         3.4  -1.33575163         0.3     setosa
## 8            5.0         3.4  -1.27910398         0.2     setosa
## 9            4.4         2.9  -1.33575163         0.2     setosa
## 10           4.9         3.1  -1.27910398         0.1     setosa
## 11           5.4         3.7  -1.27910398         0.2     setosa
## 12           4.8         3.4  -1.22245633         0.2     setosa
## 13           4.8         3.0  -1.33575163         0.1     setosa
## 14           4.3         3.0  -1.50569459         0.1     setosa
## 15           5.8         4.0  -1.44904694         0.2     setosa
## 16           5.7         4.4  -1.27910398         0.4     setosa
## 17           5.4         3.9  -1.39239929         0.4     setosa
## 18           5.1         3.5  -1.33575163         0.3     setosa
## 19           5.7         3.8  -1.16580868         0.3     setosa
## 20           5.1         3.8  -1.27910398         0.3     setosa
## 21           5.4         3.4  -1.16580868         0.2     setosa
## 22           5.1         3.7  -1.27910398         0.4     setosa
## 23           4.6         3.6  -1.56234224         0.2     setosa
## 24           5.1         3.3  -1.16580868         0.5     setosa
## 25           4.8         3.4  -1.05251337         0.2     setosa
## 26           5.0         3.0  -1.22245633         0.2     setosa
## 27           5.0         3.4  -1.22245633         0.4     setosa
## 28           5.2         3.5  -1.27910398         0.2     setosa
## 29           5.2         3.4  -1.33575163         0.2     setosa
## 30           4.7         3.2  -1.22245633         0.2     setosa
## 31           4.8         3.1  -1.22245633         0.2     setosa
## 32           5.4         3.4  -1.27910398         0.4     setosa
## 33           5.2         4.1  -1.27910398         0.1     setosa
## 34           5.5         4.2  -1.33575163         0.2     setosa
## 35           4.9         3.1  -1.27910398         0.2     setosa
## 36           5.0         3.2  -1.44904694         0.2     setosa
## 37           5.5         3.5  -1.39239929         0.2     setosa
## 38           4.9         3.6  -1.33575163         0.1     setosa
## 39           4.4         3.0  -1.39239929         0.2     setosa
## 40           5.1         3.4  -1.27910398         0.2     setosa
## 41           5.0         3.5  -1.39239929         0.3     setosa
## 42           4.5         2.3  -1.39239929         0.3     setosa
## 43           4.4         3.2  -1.39239929         0.2     setosa
## 44           5.0         3.5  -1.22245633         0.6     setosa
## 45           5.1         3.8  -1.05251337         0.4     setosa
## 46           4.8         3.0  -1.33575163         0.3     setosa
## 47           5.1         3.8  -1.22245633         0.2     setosa
## 48           4.6         3.2  -1.33575163         0.2     setosa
## 49           5.3         3.7  -1.27910398         0.2     setosa
## 50           5.0         3.3  -1.33575163         0.2     setosa
## 51           7.0         3.2   0.53362088         1.4 versicolor
## 52           6.4         3.2   0.42032558         1.5 versicolor
## 53           6.9         3.1   0.64691619         1.5 versicolor
## 54           5.5         2.3   0.13708732         1.3 versicolor
## 55           6.5         2.8   0.47697323         1.5 versicolor
## 56           5.7         2.8   0.42032558         1.3 versicolor
## 57           6.3         3.3   0.53362088         1.6 versicolor
## 58           4.9         2.4  -0.25944625         1.0 versicolor
## 59           6.6         2.9   0.47697323         1.3 versicolor
## 60           5.2         2.7   0.08043967         1.4 versicolor
## 61           5.0         2.0  -0.14615094         1.0 versicolor
## 62           5.9         3.0   0.25038262         1.5 versicolor
## 63           6.0         2.2   0.13708732         1.0 versicolor
## 64           6.1         2.9   0.53362088         1.4 versicolor
## 65           5.6         2.9  -0.08950329         1.3 versicolor
## 66           6.7         3.1   0.36367793         1.4 versicolor
## 67           5.6         3.0   0.42032558         1.5 versicolor
## 68           5.8         2.7   0.19373497         1.0 versicolor
## 69           6.2         2.2   0.42032558         1.5 versicolor
## 70           5.6         2.5   0.08043967         1.1 versicolor
## 71           5.9         3.2   0.59026853         1.8 versicolor
## 72           6.1         2.8   0.13708732         1.3 versicolor
## 73           6.3         2.5   0.64691619         1.5 versicolor
## 74           6.1         2.8   0.53362088         1.2 versicolor
## 75           6.4         2.9   0.30703027         1.3 versicolor
## 76           6.6         3.0   0.36367793         1.4 versicolor
## 77           6.8         2.8   0.59026853         1.4 versicolor
## 78           6.7         3.0   0.70356384         1.7 versicolor
## 79           6.0         2.9   0.42032558         1.5 versicolor
## 80           5.7         2.6  -0.14615094         1.0 versicolor
## 81           5.5         2.4   0.02379201         1.1 versicolor
## 82           5.5         2.4  -0.03285564         1.0 versicolor
## 83           5.8         2.7   0.08043967         1.2 versicolor
## 84           6.0         2.7   0.76021149         1.6 versicolor
## 85           5.4         3.0   0.42032558         1.5 versicolor
## 86           6.0         3.4   0.42032558         1.6 versicolor
## 87           6.7         3.1   0.53362088         1.5 versicolor
## 88           6.3         2.3   0.36367793         1.3 versicolor
## 89           5.6         3.0   0.19373497         1.3 versicolor
## 90           5.5         2.5   0.13708732         1.3 versicolor
## 91           5.5         2.6   0.36367793         1.2 versicolor
## 92           6.1         3.0   0.47697323         1.4 versicolor
## 93           5.8         2.6   0.13708732         1.2 versicolor
## 94           5.0         2.3  -0.25944625         1.0 versicolor
## 95           5.6         2.7   0.25038262         1.3 versicolor
## 96           5.7         3.0   0.25038262         1.2 versicolor
## 97           5.7         2.9   0.25038262         1.3 versicolor
## 98           6.2         2.9   0.30703027         1.3 versicolor
## 99           5.1         2.5  -0.42938920         1.1 versicolor
## 100          5.7         2.8   0.19373497         1.3 versicolor
## 101          6.3         3.3   1.27004036         2.5  virginica
## 102          5.8         2.7   0.76021149         1.9  virginica
## 103          7.1         3.0   1.21339271         2.1  virginica
## 104          6.3         2.9   1.04344975         1.8  virginica
## 105          6.5         3.0   1.15674505         2.2  virginica
## 106          7.6         3.0   1.60992627         2.1  virginica
## 107          4.9         2.5   0.42032558         1.7  virginica
## 108          7.3         2.9   1.43998331         1.8  virginica
## 109          6.7         2.5   1.15674505         1.8  virginica
## 110          7.2         3.6   1.32668801         2.5  virginica
## 111          6.5         3.2   0.76021149         2.0  virginica
## 112          6.4         2.7   0.87350679         1.9  virginica
## 113          6.8         3.0   0.98680210         2.1  virginica
## 114          5.7         2.5   0.70356384         2.0  virginica
## 115          5.8         2.8   0.76021149         2.4  virginica
## 116          6.4         3.2   0.87350679         2.3  virginica
## 117          6.5         3.0   0.98680210         1.8  virginica
## 118          7.7         3.8   1.66657392         2.2  virginica
## 119          7.7         2.6   1.77986923         2.3  virginica
## 120          6.0         2.2   0.70356384         1.5  virginica
## 121          6.9         3.2   1.10009740         2.3  virginica
## 122          5.6         2.8   0.64691619         2.0  virginica
## 123          7.7         2.8   1.66657392         2.0  virginica
## 124          6.3         2.7   0.64691619         1.8  virginica
## 125          6.7         3.3   1.10009740         2.1  virginica
## 126          7.2         3.2   1.27004036         1.8  virginica
## 127          6.2         2.8   0.59026853         1.8  virginica
## 128          6.1         3.0   0.64691619         1.8  virginica
## 129          6.4         2.8   1.04344975         2.1  virginica
## 130          7.2         3.0   1.15674505         1.6  virginica
## 131          7.4         2.8   1.32668801         1.9  virginica
## 132          7.9         3.8   1.49663097         2.0  virginica
## 133          6.4         2.8   1.04344975         2.2  virginica
## 134          6.3         2.8   0.76021149         1.5  virginica
## 135          6.1         2.6   1.04344975         1.4  virginica
## 136          7.7         3.0   1.32668801         2.3  virginica
## 137          6.3         3.4   1.04344975         2.4  virginica
## 138          6.4         3.1   0.98680210         1.8  virginica
## 139          6.0         3.0   0.59026853         1.8  virginica
## 140          6.9         3.1   0.93015445         2.1  virginica
## 141          6.7         3.1   1.04344975         2.4  virginica
## 142          6.9         3.1   0.76021149         2.3  virginica
## 143          5.8         2.7   0.76021149         1.9  virginica
## 144          6.8         3.2   1.21339271         2.3  virginica
## 145          6.7         3.3   1.10009740         2.5  virginica
## 146          6.7         3.0   0.81685914         2.3  virginica
## 147          6.3         2.5   0.70356384         1.9  virginica
## 148          6.5         3.0   0.81685914         2.0  virginica
## 149          6.2         3.4   0.93015445         2.3  virginica
## 150          5.9         3.0   0.76021149         1.8  virginica
```

---
# Solutions

2. The  `vars()` function.


```r
stdize_column &lt;- function(dat, variable) {
  dat &lt;- dat %&gt;%
    mutate_at(variable, standardize)
  return(dat)
}

stdize_column(iris, vars(Petal.Length))
```

```
##     Sepal.Length Sepal.Width Petal.Length Petal.Width    Species
## 1            5.1         3.5  -1.33575163         0.2     setosa
## 2            4.9         3.0  -1.33575163         0.2     setosa
## 3            4.7         3.2  -1.39239929         0.2     setosa
## 4            4.6         3.1  -1.27910398         0.2     setosa
## 5            5.0         3.6  -1.33575163         0.2     setosa
## 6            5.4         3.9  -1.16580868         0.4     setosa
## 7            4.6         3.4  -1.33575163         0.3     setosa
## 8            5.0         3.4  -1.27910398         0.2     setosa
## 9            4.4         2.9  -1.33575163         0.2     setosa
## 10           4.9         3.1  -1.27910398         0.1     setosa
## 11           5.4         3.7  -1.27910398         0.2     setosa
## 12           4.8         3.4  -1.22245633         0.2     setosa
## 13           4.8         3.0  -1.33575163         0.1     setosa
## 14           4.3         3.0  -1.50569459         0.1     setosa
## 15           5.8         4.0  -1.44904694         0.2     setosa
## 16           5.7         4.4  -1.27910398         0.4     setosa
## 17           5.4         3.9  -1.39239929         0.4     setosa
## 18           5.1         3.5  -1.33575163         0.3     setosa
## 19           5.7         3.8  -1.16580868         0.3     setosa
## 20           5.1         3.8  -1.27910398         0.3     setosa
## 21           5.4         3.4  -1.16580868         0.2     setosa
## 22           5.1         3.7  -1.27910398         0.4     setosa
## 23           4.6         3.6  -1.56234224         0.2     setosa
## 24           5.1         3.3  -1.16580868         0.5     setosa
## 25           4.8         3.4  -1.05251337         0.2     setosa
## 26           5.0         3.0  -1.22245633         0.2     setosa
## 27           5.0         3.4  -1.22245633         0.4     setosa
## 28           5.2         3.5  -1.27910398         0.2     setosa
## 29           5.2         3.4  -1.33575163         0.2     setosa
## 30           4.7         3.2  -1.22245633         0.2     setosa
## 31           4.8         3.1  -1.22245633         0.2     setosa
## 32           5.4         3.4  -1.27910398         0.4     setosa
## 33           5.2         4.1  -1.27910398         0.1     setosa
## 34           5.5         4.2  -1.33575163         0.2     setosa
## 35           4.9         3.1  -1.27910398         0.2     setosa
## 36           5.0         3.2  -1.44904694         0.2     setosa
## 37           5.5         3.5  -1.39239929         0.2     setosa
## 38           4.9         3.6  -1.33575163         0.1     setosa
## 39           4.4         3.0  -1.39239929         0.2     setosa
## 40           5.1         3.4  -1.27910398         0.2     setosa
## 41           5.0         3.5  -1.39239929         0.3     setosa
## 42           4.5         2.3  -1.39239929         0.3     setosa
## 43           4.4         3.2  -1.39239929         0.2     setosa
## 44           5.0         3.5  -1.22245633         0.6     setosa
## 45           5.1         3.8  -1.05251337         0.4     setosa
## 46           4.8         3.0  -1.33575163         0.3     setosa
## 47           5.1         3.8  -1.22245633         0.2     setosa
## 48           4.6         3.2  -1.33575163         0.2     setosa
## 49           5.3         3.7  -1.27910398         0.2     setosa
## 50           5.0         3.3  -1.33575163         0.2     setosa
## 51           7.0         3.2   0.53362088         1.4 versicolor
## 52           6.4         3.2   0.42032558         1.5 versicolor
## 53           6.9         3.1   0.64691619         1.5 versicolor
## 54           5.5         2.3   0.13708732         1.3 versicolor
## 55           6.5         2.8   0.47697323         1.5 versicolor
## 56           5.7         2.8   0.42032558         1.3 versicolor
## 57           6.3         3.3   0.53362088         1.6 versicolor
## 58           4.9         2.4  -0.25944625         1.0 versicolor
## 59           6.6         2.9   0.47697323         1.3 versicolor
## 60           5.2         2.7   0.08043967         1.4 versicolor
## 61           5.0         2.0  -0.14615094         1.0 versicolor
## 62           5.9         3.0   0.25038262         1.5 versicolor
## 63           6.0         2.2   0.13708732         1.0 versicolor
## 64           6.1         2.9   0.53362088         1.4 versicolor
## 65           5.6         2.9  -0.08950329         1.3 versicolor
## 66           6.7         3.1   0.36367793         1.4 versicolor
## 67           5.6         3.0   0.42032558         1.5 versicolor
## 68           5.8         2.7   0.19373497         1.0 versicolor
## 69           6.2         2.2   0.42032558         1.5 versicolor
## 70           5.6         2.5   0.08043967         1.1 versicolor
## 71           5.9         3.2   0.59026853         1.8 versicolor
## 72           6.1         2.8   0.13708732         1.3 versicolor
## 73           6.3         2.5   0.64691619         1.5 versicolor
## 74           6.1         2.8   0.53362088         1.2 versicolor
## 75           6.4         2.9   0.30703027         1.3 versicolor
## 76           6.6         3.0   0.36367793         1.4 versicolor
## 77           6.8         2.8   0.59026853         1.4 versicolor
## 78           6.7         3.0   0.70356384         1.7 versicolor
## 79           6.0         2.9   0.42032558         1.5 versicolor
## 80           5.7         2.6  -0.14615094         1.0 versicolor
## 81           5.5         2.4   0.02379201         1.1 versicolor
## 82           5.5         2.4  -0.03285564         1.0 versicolor
## 83           5.8         2.7   0.08043967         1.2 versicolor
## 84           6.0         2.7   0.76021149         1.6 versicolor
## 85           5.4         3.0   0.42032558         1.5 versicolor
## 86           6.0         3.4   0.42032558         1.6 versicolor
## 87           6.7         3.1   0.53362088         1.5 versicolor
## 88           6.3         2.3   0.36367793         1.3 versicolor
## 89           5.6         3.0   0.19373497         1.3 versicolor
## 90           5.5         2.5   0.13708732         1.3 versicolor
## 91           5.5         2.6   0.36367793         1.2 versicolor
## 92           6.1         3.0   0.47697323         1.4 versicolor
## 93           5.8         2.6   0.13708732         1.2 versicolor
## 94           5.0         2.3  -0.25944625         1.0 versicolor
## 95           5.6         2.7   0.25038262         1.3 versicolor
## 96           5.7         3.0   0.25038262         1.2 versicolor
## 97           5.7         2.9   0.25038262         1.3 versicolor
## 98           6.2         2.9   0.30703027         1.3 versicolor
## 99           5.1         2.5  -0.42938920         1.1 versicolor
## 100          5.7         2.8   0.19373497         1.3 versicolor
## 101          6.3         3.3   1.27004036         2.5  virginica
## 102          5.8         2.7   0.76021149         1.9  virginica
## 103          7.1         3.0   1.21339271         2.1  virginica
## 104          6.3         2.9   1.04344975         1.8  virginica
## 105          6.5         3.0   1.15674505         2.2  virginica
## 106          7.6         3.0   1.60992627         2.1  virginica
## 107          4.9         2.5   0.42032558         1.7  virginica
## 108          7.3         2.9   1.43998331         1.8  virginica
## 109          6.7         2.5   1.15674505         1.8  virginica
## 110          7.2         3.6   1.32668801         2.5  virginica
## 111          6.5         3.2   0.76021149         2.0  virginica
## 112          6.4         2.7   0.87350679         1.9  virginica
## 113          6.8         3.0   0.98680210         2.1  virginica
## 114          5.7         2.5   0.70356384         2.0  virginica
## 115          5.8         2.8   0.76021149         2.4  virginica
## 116          6.4         3.2   0.87350679         2.3  virginica
## 117          6.5         3.0   0.98680210         1.8  virginica
## 118          7.7         3.8   1.66657392         2.2  virginica
## 119          7.7         2.6   1.77986923         2.3  virginica
## 120          6.0         2.2   0.70356384         1.5  virginica
## 121          6.9         3.2   1.10009740         2.3  virginica
## 122          5.6         2.8   0.64691619         2.0  virginica
## 123          7.7         2.8   1.66657392         2.0  virginica
## 124          6.3         2.7   0.64691619         1.8  virginica
## 125          6.7         3.3   1.10009740         2.1  virginica
## 126          7.2         3.2   1.27004036         1.8  virginica
## 127          6.2         2.8   0.59026853         1.8  virginica
## 128          6.1         3.0   0.64691619         1.8  virginica
## 129          6.4         2.8   1.04344975         2.1  virginica
## 130          7.2         3.0   1.15674505         1.6  virginica
## 131          7.4         2.8   1.32668801         1.9  virginica
## 132          7.9         3.8   1.49663097         2.0  virginica
## 133          6.4         2.8   1.04344975         2.2  virginica
## 134          6.3         2.8   0.76021149         1.5  virginica
## 135          6.1         2.6   1.04344975         1.4  virginica
## 136          7.7         3.0   1.32668801         2.3  virginica
## 137          6.3         3.4   1.04344975         2.4  virginica
## 138          6.4         3.1   0.98680210         1.8  virginica
## 139          6.0         3.0   0.59026853         1.8  virginica
## 140          6.9         3.1   0.93015445         2.1  virginica
## 141          6.7         3.1   1.04344975         2.4  virginica
## 142          6.9         3.1   0.76021149         2.3  virginica
## 143          5.8         2.7   0.76021149         1.9  virginica
## 144          6.8         3.2   1.21339271         2.3  virginica
## 145          6.7         3.3   1.10009740         2.5  virginica
## 146          6.7         3.0   0.81685914         2.3  virginica
## 147          6.3         2.5   0.70356384         1.9  virginica
## 148          6.5         3.0   0.81685914         2.0  virginica
## 149          6.2         3.4   0.93015445         2.3  virginica
## 150          5.9         3.0   0.76021149         1.8  virginica
```

**This only works for `mutate()` type functions, that do calculations on the variable.**

---
# Solutions

3.  The **tunnelling** trick (`{{ }}`)


```r
stdize_column &lt;- function(dat, variable) {
  new_var &lt;- dat %&gt;%
    pull({{variable}}) %&gt;%
    standardize()
  return(new_var)
}

stdize_column(iris, Petal.Length)
```

```
##   [1] -1.33575163 -1.33575163 -1.39239929 -1.27910398 -1.33575163 -1.16580868
##   [7] -1.33575163 -1.27910398 -1.33575163 -1.27910398 -1.27910398 -1.22245633
##  [13] -1.33575163 -1.50569459 -1.44904694 -1.27910398 -1.39239929 -1.33575163
##  [19] -1.16580868 -1.27910398 -1.16580868 -1.27910398 -1.56234224 -1.16580868
##  [25] -1.05251337 -1.22245633 -1.22245633 -1.27910398 -1.33575163 -1.22245633
##  [31] -1.22245633 -1.27910398 -1.27910398 -1.33575163 -1.27910398 -1.44904694
##  [37] -1.39239929 -1.33575163 -1.39239929 -1.27910398 -1.39239929 -1.39239929
##  [43] -1.39239929 -1.22245633 -1.05251337 -1.33575163 -1.22245633 -1.33575163
##  [49] -1.27910398 -1.33575163  0.53362088  0.42032558  0.64691619  0.13708732
##  [55]  0.47697323  0.42032558  0.53362088 -0.25944625  0.47697323  0.08043967
##  [61] -0.14615094  0.25038262  0.13708732  0.53362088 -0.08950329  0.36367793
##  [67]  0.42032558  0.19373497  0.42032558  0.08043967  0.59026853  0.13708732
##  [73]  0.64691619  0.53362088  0.30703027  0.36367793  0.59026853  0.70356384
##  [79]  0.42032558 -0.14615094  0.02379201 -0.03285564  0.08043967  0.76021149
##  [85]  0.42032558  0.42032558  0.53362088  0.36367793  0.19373497  0.13708732
##  [91]  0.36367793  0.47697323  0.13708732 -0.25944625  0.25038262  0.25038262
##  [97]  0.25038262  0.30703027 -0.42938920  0.19373497  1.27004036  0.76021149
## [103]  1.21339271  1.04344975  1.15674505  1.60992627  0.42032558  1.43998331
## [109]  1.15674505  1.32668801  0.76021149  0.87350679  0.98680210  0.70356384
## [115]  0.76021149  0.87350679  0.98680210  1.66657392  1.77986923  0.70356384
## [121]  1.10009740  0.64691619  1.66657392  0.64691619  1.10009740  1.27004036
## [127]  0.59026853  0.64691619  1.04344975  1.15674505  1.32668801  1.49663097
## [133]  1.04344975  0.76021149  1.04344975  1.32668801  1.04344975  0.98680210
## [139]  0.59026853  0.93015445  1.04344975  0.76021149  0.76021149  1.21339271
## [145]  1.10009740  0.81685914  0.70356384  0.81685914  0.93015445  0.76021149
```


&lt;code class ='r hljs remark-code'&gt;stdize_column &lt;- function(dat, variable) {&lt;br&gt;&amp;nbsp;&amp;nbsp;new_var &lt;- dat %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;pull(&lt;span style="background-color:#ffff7f"&gt;{{variable}}&lt;/span&gt;) %&gt;%&lt;br&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;standardize()&lt;br&gt;&amp;nbsp;&amp;nbsp;return(new_var)&lt;br&gt;}&lt;br&gt;&lt;br&gt;stdize_column(iris, Petal.Length)&lt;/code&gt;

```

##   [1] -1.33575163 -1.33575163 -1.39239929 -1.27910398 -1.33575163 -1.16580868
##   [7] -1.33575163 -1.27910398 -1.33575163 -1.27910398 -1.27910398 -1.22245633
##  [13] -1.33575163 -1.50569459 -1.44904694 -1.27910398 -1.39239929 -1.33575163
##  [19] -1.16580868 -1.27910398 -1.16580868 -1.27910398 -1.56234224 -1.16580868
##  [25] -1.05251337 -1.22245633 -1.22245633 -1.27910398 -1.33575163 -1.22245633
##  [31] -1.22245633 -1.27910398 -1.27910398 -1.33575163 -1.27910398 -1.44904694
##  [37] -1.39239929 -1.33575163 -1.39239929 -1.27910398 -1.39239929 -1.39239929
##  [43] -1.39239929 -1.22245633 -1.05251337 -1.33575163 -1.22245633 -1.33575163
##  [49] -1.27910398 -1.33575163  0.53362088  0.42032558  0.64691619  0.13708732
##  [55]  0.47697323  0.42032558  0.53362088 -0.25944625  0.47697323  0.08043967
##  [61] -0.14615094  0.25038262  0.13708732  0.53362088 -0.08950329  0.36367793
##  [67]  0.42032558  0.19373497  0.42032558  0.08043967  0.59026853  0.13708732
##  [73]  0.64691619  0.53362088  0.30703027  0.36367793  0.59026853  0.70356384
##  [79]  0.42032558 -0.14615094  0.02379201 -0.03285564  0.08043967  0.76021149
##  [85]  0.42032558  0.42032558  0.53362088  0.36367793  0.19373497  0.13708732
##  [91]  0.36367793  0.47697323  0.13708732 -0.25944625  0.25038262  0.25038262
##  [97]  0.25038262  0.30703027 -0.42938920  0.19373497  1.27004036  0.76021149
## [103]  1.21339271  1.04344975  1.15674505  1.60992627  0.42032558  1.43998331
## [109]  1.15674505  1.32668801  0.76021149  0.87350679  0.98680210  0.70356384
## [115]  0.76021149  0.87350679  0.98680210  1.66657392  1.77986923  0.70356384
## [121]  1.10009740  0.64691619  1.66657392  0.64691619  1.10009740  1.27004036
## [127]  0.59026853  0.64691619  1.04344975  1.15674505  1.32668801  1.49663097
## [133]  1.04344975  0.76021149  1.04344975  1.32668801  1.04344975  0.98680210
## [139]  0.59026853  0.93015445  1.04344975  0.76021149  0.76021149  1.21339271
## [145]  1.10009740  0.81685914  0.70356384  0.81685914  0.93015445  0.76021149

```

**This only works for `pull()` and `select()` type functions, that use the name of the variable to subset the data.**

---
class: center, middle, inverse

# Tip 1:
## Keep thinking about object types and structures!!!

---

class: center, middle, inverse

# Tip 2:
## If you want to write a function for data wrangling, consider arguments that expect VECTORS rather than VARIABLE NAMES

---
# BUT WAIT

Perhaps you observed that we haven't *completely* eliminated copy-pasting!


```r
stdize_column &lt;- function(dat, variable) {
  dat[[variable]] &lt;- standardize(dat[[variable]])
  return(dat)
}

iris &lt;- iris %&gt;%
  stdize_column("Petal.Length") %&gt;%
  stdize_column("Petal.Width") %&gt;%
  stdize_column("Sepal.Length") %&gt;%
  stdize_column("Sepal.Width")
```

--

Stay tuned...

---
class: center, middle

# Debugging

---


```r
fibonacci &lt;- function(start, len) {
  
  fib &lt;- vector()
  
  for (i in 1:len) {
    
    fib[i + 1] &lt;- fib[i] + fib[i - 1]
    
  }
  
  return(fib)
  
  
}
```

---
# Debugging tricks

## `print()`

## `browser()`

## `debugonce()`

(Try it.)



    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"highlightStyle": "github",
"highlightLines": true,
"countIncrementalSlides": false,
"ratio": "16:9"
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
